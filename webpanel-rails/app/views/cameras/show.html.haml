- model_class = Camera
.page-header
  %h1=t '.title', :default => model_class.model_name.human

%p
  %strong= model_class.human_attribute_name(:url) + ':'
  %br
  = @camera.url
%p
  %strong= model_class.human_attribute_name(:analize_frames) + ':'
  %br
  = @camera.analize_frames

%embed#vlc{type: "application/x-vlc-plugin", pluginspage: "http://www.videolan.org", width: 640, height: 480, toolbar: 'false'}/
%object{classid: "clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921", codebase: "http://download.videolan.org/pub/videolan/vlc/last/win32/axvlc.cab"}

.timeline{data: { date: Date.today.to_s }}
= link_to 'Prev', '#'
= link_to 'Next', '#'
%p
  %strong Events
  %table.table.table-striped.table-condensed
    %thead
      %tr
        %th Started at
        %th Finished at
    %tbody
      - @camera.events.each do |ev|
        %tr
          %td= ev.started_at
          %td= ev.finished_at

.form-actions
  = link_to t('.back', :default => t("helpers.links.back")), cameras_path, :class => 'btn'
  = link_to t('.edit', :default => t("helpers.links.edit")), edit_camera_path(@camera), :class => 'btn'
  = link_to t('.destroy', :default => t("helpers.links.destroy")), camera_path(@camera), :method => "delete", :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-danger'

- content_for :js do
  :javascript
    $(function() {
      var vlc = document.getElementById("vlc");
      $.ajax({
        url: "#{timeline_entries_camera_path(@camera)}",
        type: "GET",
        dataType: 'json',
        data: { date: $('.timeline').data('date') },
        success: function(data) {
          $.each(data.entries, function(i, entry) {
            $('<div>').attr('class', entry.entry_type)
              .data('info', {starts_at: entry.started_at, finished_at: entry.finished_at})
              .css({width: entry.rel_width, marginLeft: entry.rel_margin})
              .appendTo('.timeline');
          });
        }
      });
      $('.timeline').click(function(e) {
        var posX = $(this).position().left;
        var percentage = (e.pageX - posX) / $(this).parent().width() * 100;
        $.ajax({
          url: "#{seek_camera_path(@camera)}",
          type: "GET",
          dataType: 'json',
          data: { date: $('.timeline').data('date'), position: percentage },
          success: function(data) {
            var id = vlc.playlist.add(data.url, "");
            vlc.playlist.playItem(id);
          }
        });
      });
    });
